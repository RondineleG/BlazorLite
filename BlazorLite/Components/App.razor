
@using BlazorLite.Data
@using BlazorLite.Models

@inject BlazorLite.Data.AppDataContext _appDataContext



<div class="row mb-3">
    <div class="col-12 alert-primary">
        <h3>Novo Desenvolvedor</h3>
        <div>

            <label>Nome:</label><br />
            <input type="text" id="name" @bind="@Pessoa.Nome" class="form-control" />
            <br />
            <label>Especialidade:</label><br />
            <textarea @bind="@Pessoa.Especialidade" class="form-control"></textarea>
            <br />

            @if (ShowConfirmEdit)
            {
                <button class="btn btn-primary btn-lg" @onclick="ConfirmEditDev">Editar</button>
            }
            else
            {
                <button type="submit" class="btn btn-primary btn-lg" @onclick="AddDev">Cadastrar</button>
            }


        </div>
    </div>
</div>


<table class="table table-hover">
    <thead>
        <tr class="active">
            <th>Id</th>
            <th>Nome</th>
            <th>Especialidade</th>
            <th></th>
        </tr>
    </thead>
    <tbody class="active">
        @for (int i = 0; i < Pessoas.Count; i++)
        {
            var pessoa = Pessoas[i];
        <tr>
            <td>@pessoa.Id</td>
            <td>@pessoa.Nome</td>
            <td>@pessoa.Especialidade</td>
            <td></td>
            <td></td>
            <td>
                <a class="btn btn-danger" @onclick="()=>RemoveDev(pessoa)">Deletar</a>
                <a class="btn btn-primary" @onclick="()=>EditDev(pessoa)">Editar</a>
            </td>
        </tr>
        }

    </tbody>
</table>

@code{
    private Pessoa Pessoa = new Pessoa();
    bool ShowConfirmEdit;
    public int counter;

    public IList<Pessoa> Pessoas { get; set; }

    protected override void OnInitialized()
    {
        counter = 1;
        ShowConfirmEdit = false;
        Pessoas = _appDataContext.Pessoas.ToList();
    }

    private void AddDev()
    {
        if (ShowConfirmEdit)
        {
            return;
        }
        _appDataContext.Pessoas.Add(Pessoa);
        _appDataContext.SaveChanges();

        Pessoas.Add(Pessoa);
        Pessoa = new Pessoa();
    }

    private void RemoveDev(Pessoa pessoa)
    {
        _appDataContext.Pessoas.Remove(pessoa);
        _appDataContext.SaveChanges();

        Pessoas.Remove(pessoa);
    }

    private void EditDev(Pessoa pessoa)
    {
        ShowConfirmEdit = true;
        this.Pessoa = pessoa;
    }

    private async Task ConfirmEditDev()
    {
        _appDataContext.Pessoas.Update(Pessoa);
        await _appDataContext.SaveChangesAsync();
        Pessoa = new Pessoa();
    }


}